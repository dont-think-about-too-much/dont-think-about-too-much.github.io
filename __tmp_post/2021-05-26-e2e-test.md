---
layout: post
title: Node End To End Test/E2E [ Node 백엔드 제작시 마주칠 것들 ]
tags: [Node, Backend, TEST, E2E]
---

>개별 백엔드 API를 요청하고 결과값이 기대한 값과 같은지 확인하는 것이 E2E 테스트이다.

바로바로 해보자.

> 1. jest, supertest 설치
> 2. 

## jest 설치
```ts
npm install jest --save-dev
```
jest.config.js는 jest 설정을 모아두는 곳이다.

```js
// jest.config.js
module.exports = {
  name: "프로젝트 이름",
  preset: "ts-jest",
  testEnvironment: "node",
  testMatch: [ "**/__tests__/**/*.ts", "**/?(*.)+(spec|test).ts" ]
  // __test__ 파일안의 .ts를 실행 혹은 .spec.ts .test.ts 파일이 해당한다.
};
```

설치와 설정을 해뒀으니 테스트를 실행할 스크립트를 적어두자. `package.json`

```json
"scripts": {
    "test": "jest",
}
```


# 뭘 테스트해야할지 모르겠다면

## 기본적인 테스트
- 인풋들이 제대로 입력되는지,
- 필수 값이 아닌 인풋들이 들어가지 않았을 때 디폴트값, 혹은 의도된 값으로 자동으로 설정되는지.
- 응답 코드가 예상대로 반환되는지

## 메서드별
### GET 
- 있을 때: 페이지네이션이 있다면 페이지네이션이 정상 응답
- 없을 때: 값이 없을 시 의도한대로 응답하는지
- 필요한 데이터들이 모두 반환되는지

### POST
- 로직적으로 유니크해야하는 값을 넣었을때 Duplicate 에러가 안나는지,
- 정의된 에러코드가 제대로 작동하는지

### PATCH
- 존재하지 않는 데이터에 대한 시도에 대한 응답
- 유니크해야하는 값으로 수정하면 duplicate 에러 응답

### DELETE
- 존재하지 않는 데이터에 대한 삭제 시도시 에러 응답
- 연결되어있는 데이터가 받는 영향이 의도된데로인지 (onCascade, onDelete)

## 입력 파라미터별
- "", " "(공백) 인풋에 대한 반응
- 특수문자 입력시
- 압뒤로 공백문자 (" 단어 ")
- 숫자 타입에 대해서 (string인 숫자로 들어오면)
- 대소문자

## 유저 인증, 유저 권한 범위에 대한 테스트
- 로그인된 상태에 따른 응답
- 유저 권한에 따른 응답.


----

E2E 테스트는 유닛테스트에 비해선 쉽다. 유닛테스트에서는 mock을 많이 활용하는데, E2E 테스트에선 보통 mock을 많이 하지 않는다. postman 으로 API요청하는 방식을 코드로 하는 느낌이라서 유닛테스트에비해 부담은 덜하다.

유닛테스트가 더 정교한 테스트가 맞다. 하지만 유닛테스트가 부담스럽거나 시간이 없거나, 기존에 작성된 API에 테스트를 추가하고 싶을 때 유닛테스트를 추가하는 것보다 E2E 테스트를 추가하는 것이 부담이 덜하다. 남에 코드에 유닛테스트를 추가하는건 진짜 힘들기 때문에 E2E로 만족하는 편이다.